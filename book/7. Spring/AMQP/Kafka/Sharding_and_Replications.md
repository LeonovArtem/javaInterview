# Шардинг (партиционирование) и репликация лидер-ведомый
![Partitions_sharding.png](img%2FPartitions_sharding.png)
- Каждый(Every) продюсер пишет в каждую Кафку
- Topic с одной партицией - очень ПЛОХО! (будет тормозить). 
- Оптимальная производительность - число партиций = числу консьюмеров (не всегда). Лучше 3-4 партиции на каждый консьюмер

### Пример 1:
Было 3 консьюмера (1 отключился). Кафка самобалансируется - на консюмер 2 трафик увеличился вдвое!
![maintainable_1.png](img%2Fmaintainable_1.png)

### Порядок чтения
![read_order_1.png](img%2Fread_order_1.png)

![read_order_2.png](img%2Fread_order_2.png)
Порядок чтения сохраняется только на уровне партиции! 
Если мы хотим сохранить порядок то мы должны прявязывать сообщения к определенной партиции.
Это делается путем передачи ключа внутри сообщения!

![Partitions_problem_1.png](img%2FPartitions_problem_1.png)
Кафка может создать все партишионы на одном узле (node)!

### Репликация
![Replications_1.png](img%2FReplications_1.png)
Реплик лучше выбирать **3** !
![Replications_factor.png](img%2FReplications_factor.png)
Репликация нужна для отказоустойчивости(не для высокой нагрузки). 
Для высокой нагрузки нужно использовать париционирование(чем больше партиций тем большую нагрузку может выжержать).

### Итог
![Kafka_result.png](img%2FKafka_result.png)
- Горизонтальное масштабирование (Horizontal scaling)
- Отказоустойчивость (fault tolerance, resiliency)
- Репликация лидер-ведомый
- Чтение только с лидера
- Партиций в 4 раза больше чем сервисов
- Минимум 3 риплики